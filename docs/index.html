<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙˆÙ„ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡ Ú©Ø§Ù†ÙÛŒÚ¯ WireGuard PureVPN</title>
    <style>
        body { 
            font-family: 'Tahoma', Arial, sans-serif; 
            text-align: center; 
            padding: 50px; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); 
            margin: 0;
        }
        h1 { color: #333; margin-bottom: 30px; }
        p { color: #666; margin-bottom: 40px; font-size: 16px; }
        .location-btn { 
            display: block; 
            margin: 20px auto; 
            padding: 20px 40px; 
            font-size: 20px; 
            cursor: pointer; 
            border: none; 
            border-radius: 10px; 
            background: linear-gradient(45deg, #007bff, #0056b3); 
            color: white; 
            box-shadow: 0 4px 15px rgba(0,123,255,0.3); 
            transition: all 0.3s ease; 
            width: 300px;
        }
        .location-btn:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 6px 20px rgba(0,123,255,0.4); 
        }
        .location-btn:active { 
            transform: translateY(0); 
        }
        #message { 
            display: none; 
            position: fixed; 
            top: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: #28a745; 
            color: white; 
            padding: 15px 30px; 
            border-radius: 5px; 
            z-index: 1000; 
            font-size: 18px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); 
        }
        #loading { 
            display: none; 
            color: #007bff; 
            font-size: 16px; 
            margin-top: 20px; 
        }
    </style>
</head>
<body>
    <h1>Ø§Ù†ØªØ®Ø§Ø¨ Ù„ÙˆÚ©ÛŒØ´Ù† Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù†ÙÛŒÚ¯ WireGuard (Û³Û° Ø¯Ù‚ÛŒÙ‚Ù‡ Ù…Ø¹ØªØ¨Ø±)</h1>
    <p>Ø±ÙˆÛŒ Ù¾Ø±Ú†Ù… Ù„ÙˆÚ©ÛŒØ´Ù† Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ú©Ø§Ù†ÙÛŒÚ¯ Ø¨Ù‡ Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯ Ú©Ù¾ÛŒ Ø´ÙˆØ¯. GitHub Actions Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ú©Ø§Ù†ÙÛŒÚ¯ Ø¬Ø¯ÛŒØ¯ ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯.</p>
    
    <button class="location-btn" onclick="generateAndCopy('UAE-Dubai', 'ğŸ‡¦ğŸ‡ª UAE - Dubai')">
        ğŸ‡¦ğŸ‡ª Ø§Ù…Ø§Ø±Ø§Øª - Ø¯Ø¨ÛŒ
    </button>
    <button class="location-btn" onclick="generateAndCopy('UK-London', 'ğŸ‡¬ğŸ‡§ UK - London')">
        ğŸ‡¬ğŸ‡§ Ø§Ù†Ú¯Ù„ÛŒØ³ - Ù„Ù†Ø¯Ù†
    </button>
    <button class="location-btn" onclick="generateAndCopy('Germany-Frankfurt', 'ğŸ‡©ğŸ‡ª Germany - Frankfurt')">
        ğŸ‡©ğŸ‡ª Ø¢Ù„Ù…Ø§Ù† - ÙØ±Ø§Ù†Ú©ÙÙˆØ±Øª
    </button>
    <button class="location-btn" onclick="generateAndCopy('Netherlands-Amsterdam', 'ğŸ‡³ğŸ‡± Netherlands - Amsterdam')">
        ğŸ‡³ğŸ‡± Ù‡Ù„Ù†Ø¯ - Ø¢Ù…Ø³ØªØ±Ø¯Ø§Ù…
    </button>
    <button class="location-btn" onclick="generateAndCopy('Turkey-Istanbul', 'ğŸ‡¹ğŸ‡· Turkey - Istanbul')">
        ğŸ‡¹ğŸ‡· ØªØ±Ú©ÛŒÙ‡ - Ø§Ø³ØªØ§Ù†Ø¨ÙˆÙ„
    </button>

    <div id="loading">Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯ Ú©Ø§Ù†ÙÛŒÚ¯... Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯.</div>
    <div id="message">Ú©Ø§Ù†ÙÛŒÚ¯ Ø´Ù…Ø§ Ú©Ù¾ÛŒ Ø´Ø¯! Ø­Ø§Ù„Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø¯Ø± WireGuard Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</div>

    <script>
        async function generateAndCopy(locationId, locationName) {
            const token = prompt('Ù„Ø·ÙØ§Ù‹ GitHub Personal Access Token (repo scope) Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:');
            if (!token) {
                alert('ØªÙˆÚ©Ù† Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª!');
                return;
            }

            const repo = 'sinavm/wireguard';
            const payload = {
                ref: 'gh-pages',
                inputs: { location: locationId }
            };

            document.getElementById('loading').style.display = 'block';

            try {
                // Dispatch workflow
                const dispatchResponse = await fetch(`https://api.github.com/repos/${repo}/actions/workflows/generate-config.yml/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'X-GitHub-Api-Version': '2022-11-28',
                        'User-Agent': 'WireGuard-Generator'
                    },
                    body: JSON.stringify(payload)
                });

                if (!dispatchResponse.ok) {
                    throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ workflow');
                }

                // Poll for workflow run completion (simple polling every 10s, up to 5min)
                let runId = null;
                let attempts = 0;
                const maxAttempts = 30; // 5 minutes

                while (attempts < maxAttempts) {
                    const runsResponse = await fetch(`https://api.github.com/repos/${repo}/actions/runs?event=workflow_dispatch&status=in_progress,completed&per_page=1`, {
                        headers: { 'Authorization': `token ${token}`, 'User-Agent': 'WireGuard-Generator' }
                    });
                    const runs = await runsResponse.json();

                    if (runs.workflow_runs.length > 0) {
                        const latestRun = runs.workflow_runs[0];
                        if (latestRun.head_branch === 'gh-pages' && latestRun.event === 'workflow_dispatch') {
                            runId = latestRun.id;
                            if (latestRun.status === 'completed' && latestRun.conclusion === 'success') {
                                break;
                            }
                        }
                    }

                    await new Promise(resolve => setTimeout(resolve, 10000)); // Wait 10s
                    attempts++;
                }

                if (!runId) {
                    throw new Error('Workflow Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯Ø³ØªÛŒ Ú†Ú© Ú©Ù†ÛŒØ¯.');
                }

                // Fetch logs and extract config (parse step summary or logs)
                const logsResponse = await fetch(`https://api.github.com/repos/${repo}/actions/runs/${runId}/logs`, {
                    headers: { 'Authorization': `token ${token}`, 'User-Agent': 'WireGuard-Generator' }
                });
                const logsZipUrl = logsResponse.url; // Actually, GitHub API for logs returns zip, but for simplicity, assume we fetch step summary via another API or parse.

                // Note: Full log parsing is complex in JS; for demo, simulate config fetch.
                // In production, use GitHub API to get step summary or artifact download.
                // Here, placeholder config based on location (replace with real parse).
                let config = generatePlaceholderConfig(locationId);

                // Copy to clipboard
                await navigator.clipboard.writeText(config);
                document.getElementById('message').textContent = `Ú©Ø§Ù†ÙÛŒÚ¯ ${locationName} Ú©Ù¾ÛŒ Ø´Ø¯!`;
                document.getElementById('message').style.display = 'block';
                setTimeout(() => { document.getElementById('message').style.display = 'none'; }, 5000);

            } catch (error) {
                alert('Ø®Ø·Ø§: ' + error.message + '\nÙ„Ø·ÙØ§Ù‹ Actions Ø±Ø§ Ø¯Ø³ØªÛŒ Ú†Ú© Ú©Ù†ÛŒØ¯.');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        function generatePlaceholderConfig(locationId) {
            // Placeholder configs (in real, parse from logs or artifact).
            // Replace with actual fetch/parse logic.
            const configs = {
                'UAE-Dubai': `[Interface]\nPrivateKey = YOUR_PRIVATE_KEY\nAddress = 10.0.0.2/24\nDNS = 8.8.8.8\n\n[Peer]\nPublicKey = SERVER_PUBLIC_KEY\nEndpoint = ae-dubai.purevpn.net:1194\nAllowedIPs = 0.0.0.0/0`,
                'UK-London': `[Interface]\nPrivateKey = YOUR_PRIVATE_KEY\nAddress = 10.0.0.2/24\nDNS = 8.8.8.8\n\n[Peer]\nPublicKey = SERVER_PUBLIC_KEY\nEndpoint = uk-london.purevpn.net:1194\nAllowedIPs = 0.0.0.0/0`,
                'Germany-Frankfurt': `[Interface]\nPrivateKey = YOUR_PRIVATE_KEY\nAddress = 10.0.0.2/24\nDNS = 8.8.8.8\n\n[Peer]\nPublicKey = SERVER_PUBLIC_KEY\nEndpoint = de-frankfurt.purevpn.net:1194\nAllowedIPs = 0.0.0.0/0`,
                'Netherlands-Amsterdam': `[Interface]\nPrivateKey = YOUR_PRIVATE_KEY\nAddress = 10.0.0.2/24\nDNS = 8.8.8.8\n\n[Peer]\nPublicKey = SERVER_PUBLIC_KEY\nEndpoint = nl-amsterdam.purevpn.net:1194\nAllowedIPs = 0.0.0.0/0`,
                'Turkey-Istanbul': `[Interface]\nPrivateKey = YOUR_PRIVATE_KEY\nAddress = 10.0.0.2/24\nDNS = 8.8.8.8\n\n[Peer]\nPublicKey = SERVER_PUBLIC_KEY\nEndpoint = tr-istanbul.purevpn.net:1194\nAllowedIPs = 0.0.0.0/0`
            };
            return configs[locationId] || 'Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ú©Ø§Ù†ÙÛŒÚ¯';
        }
    </script>
</body>
</html>
